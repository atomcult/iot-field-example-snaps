#!/bin/bash

ASSERT=`cat ${SNAP_DATA}/assert`
THESNAP=`cat ${SNAP_DATA}/thesnap`
while true;
do
  $SNAP/usr/bin/inotifywait -e open $WATCHED
  # add the assert:
  $SNAP/usr/bin/curl -X POST -sS --unix-socket /run/snapd.socket http://localhost/v2/assertions --data-binary "@${SNAP_DATA}/${ASSERT}"
  # install the snap
  $SNAP/usr/bin/curl -sS --unix-socket /run/snapd.socket --form snap=@${SNAP_DATA}/${THESNAP} http://localhost/v2/snaps

done
